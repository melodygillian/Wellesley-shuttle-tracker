<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wellesley Shuttle Finder</title>
<style>
  :root {
    --champagne: #F7E7CE;
    --pearl-gray: #DCD7D1;
    --olive-gray: #919b87;
    --soph-gray: #5a595e;
    --coral: #FF7F50;
    --tiff-blue: #0ABAB5;
    --burgundy: #800020;
    --dusty-pink: #C1A192;
  }
  body {
    background: var(--champagne);
    color: var(--soph-gray);
    font-family: 'Avenir', 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }
  .container {
    background: var(--pearl-gray);
    max-width: 460px;
    margin: 32px auto;
    border-radius: 18px;
    box-shadow: 0 4px 12px rgba(145, 155, 135, 0.16);
    padding: 32px 18px;
  }
  h1 {
    color: var(--olive-gray);
    font-weight: 700;
    font-size: 1.5em;
    margin-bottom: 14px;
    text-align: center;
  }
  #now {
    background: var(--dusty-pink);
    color: var(--soph-gray);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 1.07em;
    margin-bottom: 13px;
    text-align: center;
  }
  .info, .result, #schedule {
    margin-bottom: 15px;
    font-size: 1em;
  }
  .result {
    background: var(--champagne);
    padding: 12px 16px;
    border-radius: 9px;
    box-shadow: 0 2px 8px rgba(250, 128, 114, 0.09);
    font-size: 1.12em;
  }
  .label {
    color: var(--tiff-blue);
    font-weight: 700;
  }
  .walk-time {
    color: var(--coral);
    font-weight: 500;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
    background: var(--champagne);
  }
  th, td {
    padding: 6px 4px;
    border: 1px solid var(--dusty-pink);
    font-size: 0.95em;
    text-align: center;
  }
  th {
    background: var(--pearl-gray);
    color: var(--burgundy);
    font-weight: 700;
  }
  footer {
    color: var(--soph-gray);
    text-align: center;
    font-size: 0.79em;
    margin-top: 20px;
    opacity: 0.7;
  }
  @media (max-width:440px) {
    .container { max-width: 98vw; padding: 10vw 3vw; }
    table { font-size: 0.85em; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Wellesley Shuttle Finder</h1>
  <div id="now"></div>
  <div class="info" id="status">Detecting location and schedule&hellip;</div>
  <div class="result" id="result"></div>
  <div id="schedule"></div>
</div>
<footer>
  Morandi colors | Anonymous privacy-friendly design
</footer>
<script>
  // Stops with coordinates, campus or off-campus for walking calc
  const stops = {
    "Chapel": {lat:42.293849, lon:-71.305063, type:"campus"},
    "Alumnae": {lat:42.295392, lon:-71.303625, type:"campus"},
    "Harvard Sq.": {lat:42.373605, lon:-71.109733, type:"off"},
    "77 Mass Ave.": {lat:42.360058, lon:-71.093228, type:"off"},
    "Marlboro Market": {lat:42.34861, lon:-71.05808, type:"off"},
    "Campus Center": {lat:42.296200, lon:-71.305800, type:"campus"},
    "Founders Parking Lot Gates": {lat:42.2984, lon:-71.3015, type:"campus"},
    "Olin East Hall": {lat:42.2970, lon:-71.3030, type:"campus"},
    "Babson Hollister Lot": {lat:42.2994, lon:-71.2610, type:"off"}
  };

  // Helper for time parsing "12:30 pm" -> total minutes from midnight
  function timeToMins(t){
    let [time, meridiem] = t.toLowerCase().split(' ');
    let [h, m] = time.split(':').map(Number);
    if(meridiem === 'pm' && h !== 12) h += 12;
    if(meridiem === 'am' && h === 12) h = 0;
    return h*60 + m;
  }
  // Minutes now total
  function nowMins(){
    const d=new Date();
    return d.getHours()*60+d.getMinutes();
  }
  // Distance Haversine km
  function distKm(lat1, lon1, lat2, lon2){
    const R=6371;
    const dLat=(lat2-lat1)*Math.PI/180;
    const dLon=(lon2-lon1)*Math.PI/180;
    const a=Math.sin(dLat/2)*Math.sin(dLat/2)+
      Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
      Math.sin(dLon/2)*Math.sin(dLon/2);
    return R*2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  }
  // Walking time by 5km/h approx (minutes)
  function walkingTime(dist){
    return Math.round(dist/5*60);
  }
  // Format date/time
  function formatNow(){
    const d=new Date();
    return d.toLocaleString("en-US", {weekday:"long", year:"numeric", month:"long", day:"numeric", hour:"2-digit", minute:"2-digit", hour12:true});
  }

  // SHUTTLE SCHEDULES (from official Wellesley site https://www.wellesley.edu/about-us/offices-departments/transportation/shuttle-bus-schedule)

  // Exchange Bus (Mon-Fri)
  const exchangeBus = [
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"7:40 am", "Olin East Hall":"7:42 am", "Babson Hollister Lot":"7:52 am", "Founders Parking Lot Gates":"7:55 am", "Wellesley Campus Center":"8:05 am", "Chapel":"8:07 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"8:10 am", "Olin East Hall":"8:12 am", "Babson Hollister Lot":"8:22 am", "Founders Parking Lot Gates":"8:25 am", "Wellesley Campus Center":"8:35 am", "Chapel":"8:37 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"8:40 am", "Olin East Hall":"8:42 am", "Babson Hollister Lot":"8:52 am", "Founders Parking Lot Gates":"8:55 am", "Wellesley Campus Center":"9:05 am", "Chapel":"9:07 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"9:10 am", "Olin East Hall":"9:12 am", "Babson Hollister Lot":"9:22 am", "Founders Parking Lot Gates":"9:25 am", "Wellesley Campus Center":"9:35 am", "Chapel":"9:37 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"9:40 am", "Olin East Hall":"9:42 am", "Babson Hollister Lot":"9:52 am", "Founders Parking Lot Gates":"9:55 am", "Wellesley Campus Center":"10:05 am", "Chapel":"10:07 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"10:40 am", "Olin East Hall":"10:42 am", "Babson Hollister Lot":"10:52 am", "Founders Parking Lot Gates":"10:55 am", "Wellesley Campus Center":"11:05 am", "Chapel":"11:07 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"11:10 am", "Olin East Hall":"11:12 am", "Babson Hollister Lot":"11:22 am", "Founders Parking Lot Gates":"11:25 am", "Wellesley Campus Center":"11:35 am", "Chapel":"11:37 am" } },
    { bus:"B", stopTimes: { "Founders Parking Lot Gates":"11:40 am", "Olin East Hall":"11:42 am", "Babson Hollister Lot":"11:52 am", "Founders Parking Lot Gates":"11:55 am", "Wellesley Campus Center":"12:05 pm", "Chapel":"12:07 pm" } },
    // ... Add the rest but truncating here for brevity
  ];

  // Friday night Senate Bus schedule
  const fridayNightSenate = [
    { bus:"A", stopTimes:{ "Chapel":"6:00 pm", "Alumnae":"6:05 pm", "Harvard Sq.":"6:45 pm", "77 Mass Ave.":"7:00 pm", "Marlboro Market":"7:05 pm", "Alumnae":"7:35 pm", "Chapel":"7:40 pm" }},
    { bus:"B", stopTimes:{ "Chapel":"6:40 pm", "Alumnae":"6:45 pm", "Harvard Sq.":"7:25 pm", "77 Mass Ave.":"7:40 pm", "Marlboro Market":"7:45 pm", "Alumnae":"8:15 pm", "Chapel":"8:20 pm" }},
    // ... similarly truncated for brevity
  ];

  // Saturday AM/MID Senate Bus
  const saturdayAMMidSenate = [
    { bus: "D", stopTimes: { "Chapel":"9:00 am", "Alumnae":"9:05 am", "Harvard Sq.":"9:45 am", "77 Mass Ave.":"9:55 am", "Marlboro Market":"10:00 am", "Alumnae":"10:30 am", "Chapel":"10:35 am" }},
    { bus: "B", stopTimes: { "Chapel":"10:00 am", "Alumnae":"10:05 am", "Harvard Sq.":"10:45 am", "77 Mass Ave.":"10:55 am", "Marlboro Market":"11:00 am", "Alumnae":"11:30 am", "Chapel":"11:35 am" }},
    // ... truncated for brevity
  ];

  // Saturday Evening Senate Bus (add full data similarly)
  const saturdayEveningSenate = [
    { bus:"A", stopTimes:{ "Chapel":"3:00 pm", "Alumnae":"3:05 pm", "Harvard Sq.":"3:45 pm", "77 Mass Ave.":"3:55 pm", "Marlboro Market":"4:00 pm", "Alumnae":"4:30 pm", "Chapel":"4:35 pm" }},
    { bus:"B", stopTimes:{ "Chapel":"4:00 pm", "Alumnae":"4:05 pm", "Harvard Sq.":"4:45 pm", "77 Mass Ave.":"4:55 pm", "Marlboro Market":"5:00 pm", "Alumnae":"5:30 pm", "Chapel":"5:35 pm" }},
    // ... truncated for brevity
  ];

  // Sunday Senate Bus
  const sundaySenate = [
    { bus: "A", stopTimes: { "Chapel":"9:00 am", "Alumnae":"9:05 am", "Harvard Sq.":"9:45 am", "77 Mass Ave.":"9:55 am", "Marlboro Market":"10:00 am", "Alumnae":"10:30 am", "Chapel":"10:35 am" }},
    { bus: "A", stopTimes: { "Chapel":"11:00 am", "Alumnae":"11:05 am", "Harvard Sq.":"11:45 am", "77 Mass Ave.":"11:55 am", "Marlboro Market":"12:00 pm", "Alumnae":"12:30 pm", "Chapel":"12:35 pm" }},
    // ... truncated for brevity
  ];

  // Movie Bus (Saturday)
  const movieBus = [
    { bus:"M", stopTimes: { "Chapel": "5:00 pm", "Mall": "5:30 pm", "Chapel": "6:00 pm" } } // example times, update accordingly
  ];

  // Mall Bus (Saturday)
  const mallBus = [
    { bus:"L", stopTimes: { "Chapel": "5:30 pm", "Mall": "6:00 pm", "Chapel": "6:30 pm" } } // example times, update accordingly
  ];

  // Mapping variables for schedule displays
  const schedulesByDay = {
    1: [exchangeBus],  // Monday
    2: [exchangeBus],  // Tuesday
    3: [exchangeBus],  // Wednesday
    4: [exchangeBus],  // Thursday
    5: [exchangeBus, fridayNightSenate],  // Friday, show Exchange + Friday night Senate
    6: [saturdayAMMidSenate, saturdayEveningSenate, movieBus, mallBus], // Saturday full
    0: [sundaySenate] // Sunday
  };

  // Get current day (0=Sun,1=Mon,...)
  function getDay(){
    return new Date().getDay();
  }

  // Find closest stop to current position
  function closestStop(lat, lon){
    let minDist = Infinity, closest=null;
    for(const stopName in stops){
      const stop=stops[stopName];
      const d=distKm(lat, lon, stop.lat, stop.lon);
      if(d<minDist){
        minDist=d; closest={name:stopName, ...stop, dist:d};
      }
    }
    return closest;
  }

  // Next bus: given schedule array and stop, returns the soonest time and bus info after now
  function getNextBusForSchedule(schedule, stopName){
    const nowM = nowMins();
    let minM = Infinity, nextBus = null;
    for(const trip of schedule){
      const timeStr = trip.stopTimes[stopName];
      if(timeStr){
        const tM = timeToMins(timeStr);
        if(tM >= nowM && tM < minM){
          minM = tM;
          nextBus = {bus: trip.bus, time: timeStr, schedule: schedule, stop: stopName};
        }
      }
    }
    return nextBus;
  }

  // Get earliest next bus from multiple schedules
  function getEarliestNextBus(schedules, stopName){
    let earliest = null;
    for(const sched of schedules){
      const candidate = getNextBusForSchedule(sched, stopName);
      if(candidate){
        if(!earliest || timeToMins(candidate.time) < timeToMins(earliest.time)){
          earliest = candidate;
        }
      }
    }
    return earliest;
  }

  // Build table HTML for a single schedule
  function buildScheduleTable(schedule, title){
    let stopsOrder = Object.keys(schedule[0].stopTimes);
    let header = `<tr><th>Bus</th>`+stopsOrder.map(s=>`<th>${s}</th>`).join('')+`</tr>`;
    let rows = schedule.map(trip => `<tr><td>${trip.bus}</td>` + stopsOrder.map(s=>`<td>${trip.stopTimes[s]||''}</td>`).join('') + `</tr>`).join('');
    return `<h3>${title}</h3><table>${header}${rows}</table>`;
  }

  // Main app logic
  function main(lat, lon){
    document.getElementById('now').textContent = `Today is ${formatNow()}`;
    let day = getDay();

    // Show status info
    let cs = closestStop(lat, lon);
    let walkingDist = cs.dist.toFixed(2);
    let walkingMins = walkingTime(cs.dist);
    let status = `Location detected. Closest stop is <span class="label">${cs.name}</span>, about ${walkingDist} km (${walkingMins} min walk).`;
    document.getElementById('status').innerHTML = status;

    // Determine schedules for today
    let todaysSchedules = schedulesByDay[day] || [];

    // Determine next bus for closest stop across schedules
    let nextBus = getEarliestNextBus(todaysSchedules, cs.name);

    let resHtml = "";
    if(nextBus){
      resHtml += `<div><span class="label">Next bus</span>: Bus ${nextBus.bus} at <span class="label">${nextBus.time}</span> (Stop: <span class="label">${nextBus.stop}</span>)</div>`;
    } else {
      resHtml += `<div>No more buses today for stop <span class="label">${cs.name}</span>.</div>`;
    }
    resHtml += `<div class="walk-time">Walk time estimate: ${walkingMins} min (${walkingDist} km)</div>`;

    document.getElementById('result').innerHTML = resHtml;

    // Build table display for all today's schedules
    let tablesHtml = '';
    for(let i=0; i<todaysSchedules.length; i++){
      let sched = todaysSchedules[i];
      let title;
      switch(day){
        case 0: title = "Sunday Senate Bus Schedule"; break;
        case 6:
          if(sched===saturdayAMMidSenate) title="Saturday AM/MID Senate Bus Schedule";
          else if(sched===saturdayEveningSenate) title="Saturday Evening Senate Bus Schedule";
          else if(sched===movieBus) title="Saturday Movie Bus Schedule";
          else if(sched===mallBus) title="Saturday Mall Bus Schedule";
          break;
        case 5:
          if(sched===exchangeBus) title = "Weekday Exchange Bus Schedule";
          else if(sched===fridayNightSenate) title = "Friday Night Senate Bus Schedule";
          break;
        default:
          title = "Weekday Exchange Bus Schedule";
      }
      tablesHtml += buildScheduleTable(sched, title);
    }
    document.getElementById('schedule').innerHTML = tablesHtml;
  }

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos => {
      main(pos.coords.latitude, pos.coords.longitude);
    }, err => {
      document.getElementById('status').textContent = "Location access denied or unavailable.";
      document.getElementById('now').textContent = `Today is ${formatNow()}`;
      document.getElementById('result').textContent = "Enable location for next bus and walking info.";
      // Show all schedules for today anyway
      let day = getDay();
      let todaysSchedules = schedulesByDay[day] || [];
      let tablesHtml = '';
      for(let i=0; i<todaysSchedules.length; i++){
        tablesHtml += buildScheduleTable(todaysSchedules[i], "Bus Schedule");
      }
      document.getElementById('schedule').innerHTML = tablesHtml;
    });
  } else {
    document.getElementById('status').textContent = "Geolocation not supported on this device.";
  }
</script>
</body>
</html>
